---
description: "AnimationSystem 개발 가이드 및 규칙 - Unity 2D 애니메이션 통합 관리"
globs: ["Assets/Script/AnimationSystem/**/*.cs"]
rule_id: animation_system_rules
version: 1.2.0
alwaysApply: true
---

# AnimationSystem 개발 규칙

## 📋 시스템 개요
AnimationSystem은 Unity 2D 게임의 모든 애니메이션을 통합 관리하는 시스템입니다. 캐릭터, 스킬카드, UI 등 다양한 요소의 애니메이션을 중앙화된 방식으로 제어합니다. 플레이어와 적 스킬카드의 애니메이션을 하나의 통합 데이터베이스에서 관리하며, 타입별 필터링된 드롭다운을 통해 정확한 애니메이션 설정을 제공합니다.

## 🏗️ 폴더 구조 규칙
```
AnimationSystem/
├── Manager/           # 애니메이션 매니저 (2개 파일)
├── Interface/         # 애니메이션 인터페이스 (15개 파일)
├── Data/             # 애니메이션 데이터 (4개 파일)
├── Animator/         # 애니메이션 구현체 (14개 파일)
│   ├── CharacterAnimation/    # 캐릭터 애니메이션 (4개 파일)
│   │   ├── DeathAnimation/    # 사망 애니메이션 (1개 파일)
│   │   └── SpawnAnimation/    # 등장 애니메이션 (1개 파일)
│   └── SkillCardAnimation/    # 스킬카드 애니메이션 (7개 파일)
│       ├── DragAnimation/     # 드래그 애니메이션 (1개 파일)
│       ├── DropAnimation/     # 드롭 애니메이션 (1개 파일)
│       ├── MoveAnimation/     # 이동 애니메이션 (1개 파일)
│       ├── MoveToCombatSlotAnimation/ # 전투 슬롯 이동 (1개 파일)
│       ├── SpawnAnimation/    # 등장 애니메이션 (1개 파일)
│       ├── UseAnimation/      # 사용 애니메이션 (1개 파일)
│       └── VanishAnimation/    # 소멸 애니메이션 (1개 파일)
├── Editor/           # 에디터 도구 (3개 파일)
├── Helper/           # 애니메이션 헬퍼 (1개 파일)
└── Controllers/      # 애니메이션 컨트롤러 (2개 파일)
```

## 📁 주요 컴포넌트 규칙

### Manager 폴더 규칙 (2개 파일)
- **AnimationFacade.cs**: 애니메이션 시스템의 통합 인터페이스 (싱글톤 패턴)
- **AnimationSystemInitializer.cs**: 애니메이션 시스템 초기화 (Zenject DI)

### Interface 폴더 규칙 (15개 파일)
- **IAnimationScript.cs**: 애니메이션 스크립트 기본 인터페이스
- **ICharacterCombatSlotMoveAnimationScript.cs**: 캐릭터 전투 슬롯 이동 애니메이션
- **ICharacterDeathAnimationScript.cs**: 캐릭터 사망 애니메이션 인터페이스
- **ICharacterMoveAnimationScript.cs**: 캐릭터 이동 애니메이션 인터페이스
- **ICharacterSpawnAnimationScript.cs**: 캐릭터 등장 애니메이션 인터페이스
- **ISkillCardCombatSlotMoveAnimationScript.cs**: 스킬카드 전투 슬롯 이동 애니메이션
- **ISkillCardDeathAnimationScript.cs**: 스킬카드 사망 애니메이션 인터페이스
- **ISkillCardDragAnimationScript.cs**: 스킬카드 드래그 애니메이션 인터페이스
- **ISkillCardDropAnimationScript.cs**: 스킬카드 드롭 애니메이션 인터페이스
- **ISkillCardMoveAnimationScript.cs**: 스킬카드 이동 애니메이션 인터페이스
- **ISkillCardSpawnAnimationScript.cs**: 스킬카드 등장 애니메이션 인터페이스
- **ISkillCardUseAnimationScript.cs**: 스킬카드 사용 애니메이션 인터페이스
- **ISkillCardVanishAnimationScript.cs**: 스킬카드 소멸 애니메이션 인터페이스

### Data 폴더 규칙 (4개 파일)
- **CharacterAnimationEntry.cs**: 캐릭터 애니메이션 엔트리 데이터
- **CharacterAnimationSettings.cs**: 캐릭터 애니메이션 설정
- **UnifiedSkillCardAnimationDatabase.cs**: 통합 스킬카드 애니메이션 데이터베이스 (플레이어/적 통합)
- **UnifiedSkillCardAnimationEntry.cs**: 통합 스킬카드 애니메이션 엔트리 데이터
- **SkillCardAnimationSettings.cs**: 스킬카드 애니메이션 설정 (타입별 필터링 지원)

### Animator 폴더 규칙 (14개 파일)

#### CharacterAnimation 하위 폴더 (4개 파일)
- **DeathAnimation/**:
  - **DefaultCharacterDeathAnimation.cs**: 기본 캐릭터 사망 애니메이션
- **SpawnAnimation/**:
  - **DefaultCharacterSpawnAnimation.cs**: 기본 캐릭터 등장 애니메이션

#### SkillCardAnimation 하위 폴더 (7개 파일)
- **DragAnimation/**:
  - **DefaultSkillCardDragAnimation.cs**: 기본 스킬카드 드래그 애니메이션
- **DropAnimation/**:
  - **DefaultSkillCardDropAnimation.cs**: 기본 스킬카드 드롭 애니메이션
- **MoveAnimation/**:
  - **DefaultSkillCardMoveAnimation.cs**: 기본 스킬카드 이동 애니메이션
- **MoveToCombatSlotAnimation/**:
  - **DefaultSkillCardCombatSlotMoveAnimation.cs**: 기본 스킬카드 전투 슬롯 이동 애니메이션
- **SpawnAnimation/**:
  - **DefaultSkillCardSpawnAnimation.cs**: 기본 스킬카드 등장 애니메이션
- **UseAnimation/**:
  - **DefaultSkillCardUseAnimation.cs**: 기본 스킬카드 사용 애니메이션
- **VanishAnimation/**:
  - **DefaultSkillCardVanishAnimation.cs**: 기본 스킬카드 소멸 애니메이션

### Editor 폴더 규칙 (3개 파일)
- **UnifiedSkillCardAnimationDatabaseEditor.cs**: 통합 스킬카드 애니메이션 데이터베이스 커스텀 에디터
- **UnifiedSkillCardAnimationEntryEditor.cs**: 통합 스킬카드 애니메이션 엔트리 PropertyDrawer
- **SkillCardAnimationSettingsDrawer.cs**: 스킬카드 애니메이션 설정 PropertyDrawer (타입별 필터링)
- **AnimationDatabaseMigrator.cs**: 애니메이션 데이터베이스 마이그레이션 도구

### Helper 폴더 규칙 (1개 파일)
- **AnimationHelper.cs**: 애니메이션 유틸리티 함수

### Controllers 폴더 규칙 (2개 파일)
- **CharacterAnimationController.cs**: 캐릭터 애니메이션 컨트롤러
- **SkillCardAnimationController.cs**: 스킬카드 애니메이션 컨트롤러

## 🎯 개발 규칙

### 1. 애니메이션 구현 규칙
- **DOTween 우선 사용**: 모든 애니메이션은 코루틴 대신 DOTween 사용
- **체인 애니메이션**: `.SetEase()`, `.OnComplete()`, `.SetDelay()` 등 고급 기능 활용
- **애니메이션 풀링**: `DOTween.SetTweensCapacity()`로 성능 최적화
- **SafeMode 설정**: 안정성을 위해 DOTween SafeMode 활성화 유지

### 2. 인터페이스 구현 규칙
- 모든 애니메이션 스크립트는 해당 인터페이스를 구현해야 함
- 인터페이스명은 `I[Type][Action]AnimationScript` 형식
- 예외 처리 및 null 체크 필수

### 3. 데이터베이스 규칙
- ScriptableObject 기반 데이터베이스 사용
- 플레이어/적 구분하여 별도 데이터베이스 관리
- 커스텀 에디터를 통한 개발자 친화적 인터페이스 제공

### 4. 컨트롤러 규칙
- CharacterAnimationController: 캐릭터 애니메이션 통합 관리
- SkillCardAnimationController: 스킬카드 애니메이션 통합 관리
- 이벤트 기반 애니메이션 실행

## 🔧 사용 방법

### 기본 사용법
```csharp
// 통합된 스킬카드 애니메이션 실행 (ISkillCard 기반)
AnimationFacade.Instance.PlaySkillCardAnimation(skillCard, target, "spawn", onComplete);
AnimationFacade.Instance.PlaySkillCardAnimation(skillCard, target, "use", onComplete);

// 드래그/드롭 애니메이션 (플레이어 전용)
AnimationFacade.Instance.PlaySkillCardDragStartAnimation(skillCard, target, onComplete);
AnimationFacade.Instance.PlaySkillCardDropAnimation(skillCard, target, onComplete);

// 캐릭터 애니메이션 실행
AnimationFacade.Instance.PlayCharacterAnimation(characterId, "spawn", target, onComplete, isEnemy);
AnimationFacade.Instance.PlayCharacterDeathAnimation(characterId, target, onComplete, isEnemy);
```

### 주요 클래스 및 메서드

#### AnimationFacade 클래스
- **Instance**: 싱글톤 인스턴스
- **PlayCharacterAnimation()**: 캐릭터 애니메이션 실행
- **PlayCharacterDeathAnimation()**: 캐릭터 사망 애니메이션 실행
- **PlaySkillCardAnimation()**: 통합 스킬카드 애니메이션 실행 (ISkillCard 기반)
- **PlaySkillCardDragStartAnimation()**: 스킬카드 드래그 시작 애니메이션 (플레이어 전용)
- **PlaySkillCardDropAnimation()**: 스킬카드 드롭 애니메이션 (플레이어 전용)
- **LoadAllData()**: 모든 애니메이션 데이터 로드

#### CharacterAnimationController 클래스
- **PlayAnimation()**: 애니메이션 타입별 실행 (spawn, death, damage, heal)
- **GetSettings()**: 현재 애니메이션 설정 반환
- **UpdateSettings()**: 애니메이션 설정 업데이트
- **UpdateSpawnSettings()**: 등장 애니메이션 설정 업데이트
- **UpdateDeathSettings()**: 사망 애니메이션 설정 업데이트
- **UpdateDamageSettings()**: 피해 애니메이션 설정 업데이트

#### SkillCardAnimationController 클래스
- **PlaySpawnAnimation()**: 스킬카드 등장 애니메이션
- **PlayMoveAnimation()**: 스킬카드 이동 애니메이션
- **PlayUseAnimation()**: 스킬카드 사용 애니메이션

#### UnifiedSkillCardAnimationDatabase 클래스
- **SkillCardAnimations**: 통합 스킬카드 애니메이션 목록
- **FindEntryByCardId()**: 카드 ID로 애니메이션 엔트리 검색
- **FindEntryByCardName()**: 카드 이름으로 애니메이션 엔트리 검색

#### UnifiedSkillCardAnimationEntry 클래스
- **SkillCardDefinition**: 스킬카드 정의 참조
- **OwnerPolicy**: 소유자 정책 (Shared, Player, Enemy)
- **CanUseAnimation()**: 소유자 정책에 따른 애니메이션 사용 가능 여부 확인
- **GetSettingsByType()**: 애니메이션 타입별 설정 반환

### 애니메이션 설정 구조
```csharp
// CharacterAnimationSettings 주요 속성
public class AnimationSettings
{
    // 등장 애니메이션
    public float spawnDuration = 1.0f;
    public Vector3 spawnStartScale = Vector3.zero;
    public Vector3 spawnEndScale = Vector3.one;
    public Ease spawnEase = Ease.OutBack;
    public bool useSpawnGlow = true;
    public Color spawnGlowColor = Color.blue;
    
    // 사망 애니메이션
    public float deathDuration = 1.5f;
    public Ease deathEase = Ease.InBack;
    public bool useDeathFade = true;
    public Vector3 deathEndScale = Vector3.zero;
    
    // 피해 애니메이션
    public float damageDuration = 0.3f;
    public bool useDamageShake = true;
    public float damageShakeStrength = 0.1f;
    
    // 치유 애니메이션
    public float healDuration = 0.8f;
    public Color healGlowColor = Color.green;
}
```

### 커스텀 애니메이션 추가 절차
1. 해당 타입의 Animator 클래스 상속
2. AnimationDatabase에 애니메이션 데이터 등록
3. AnimationSettings에서 설정 구성
4. 인터페이스 구현 및 예외 처리 추가

## 🏗️ 아키텍처 패턴

### 1. Facade 패턴
- **AnimationFacade**: 복잡한 애니메이션 시스템을 단순한 인터페이스로 제공
- 싱글톤 패턴으로 전역 접근 가능

### 2. Strategy 패턴
- 다양한 애니메이션 타입을 런타임에 교체 가능
- 인터페이스 기반 구현으로 확장성 확보

### 3. Factory 패턴
- 애니메이션 객체 생성 로직 캡슐화
- 타입별 애니메이션 생성 관리

## 🔧 기술적 구현 세부사항

### 성능 최적화
- **DOTween 최적화**: 애니메이션 풀링으로 GC 압박 최소화
- **애니메이션 이벤트**: Update() 대신 DOTween 이벤트 콜백 활용
- **메모리 관리**: 애니메이션 완료 후 자동 정리

### 스레드 안전성
- 싱글톤 패턴의 스레드 안전성 보장
- 이벤트 기반 비동기 처리

## 🧪 검증/테스트 지침

### 체크리스트
- [ ] DOTween SafeMode 활성화 확인
- [ ] 애니메이션 풀링 설정 확인
- [ ] 인터페이스 구현 완전성 확인
- [ ] 예외 처리 및 null 체크 구현
- [ ] 성능 프로파일링 통과

### 재현 절차
1. 각 애니메이션 타입별 테스트 케이스 실행
2. 메모리 누수 검사
3. 프레임레이트 영향도 측정

## 📝 변경 기록(Delta)
- 형식: `YYYY-MM-DD | 작성자 | 변경 요약 | 영향도(코드/씬/문서)`

- 2025-01-27 | Maintainer | AnimationSystem 개발 문서 초기 작성 | 문서
- 2025-01-27 | Maintainer | 실제 폴더 구조 반영 및 파일 수 정정 | 문서
- 2025-01-27 | Maintainer | .mdc 규칙 파일로 변환 및 Cursor 규칙 저장 | 문서
- 2025-01-27 | Maintainer | 실제 코드 분석 기반 구체적 함수/변수/클래스 정보 추가 | 문서
- 2025-01-27 | Maintainer | 통합 애니메이션 시스템으로 마이그레이션 완료 | 코드/문서
- 2025-01-27 | Maintainer | 플레이어/적 스킬카드 애니메이션 통합 데이터베이스 구현 | 코드/문서
- 2025-01-27 | Maintainer | 타입별 필터링된 드롭다운 시스템 구현 | 코드/문서
- 2025-01-27 | Maintainer | 그룹화된 커스텀 에디터 UI 구현 | 코드/문서
- 2025-01-27 | Maintainer | 001 시리즈 제거 및 None 옵션 제거 | 코드/문서