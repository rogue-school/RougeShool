---
description: "RougeShool 프로젝트 스크립트 대체 및 마이그레이션 규칙"
globs: ["Assets/Script/**/*.cs", "Assets/Script/**/*.md"]
rule_id: script_migration_rules
version: 1.0.0
alwaysApply: false
---

# 스크립트 대체 및 마이그레이션 규칙 (Production)

> 목적: 중복 스크립트 제거, 완전한 대체, 코드 품질 향상을 통한 프로젝트 안정성과 유지보수성 확보

## 1) 적용 범위와 원칙
- 범위: `Assets/Script/**` 전역. 모든 스크립트 생성/수정/삭제 시 적용
- 원칙: 완전한 대체 → 단계적 마이그레이션 → 품질 검증 → 문서 동기화
- Single Source of Truth: 동일 기능의 스크립트는 단일 출처만 유지

## 2) 스크립트 대체 착수 기준(의사결정 트리)
- 필요 조건 중 1개 이상이면 착수:
  - 동일/유사 기능의 스크립트 ≥ 2개 존재
  - Obsolete/Deprecated/Legacy 표시된 스크립트 존재
  - 새로운 아키텍처 패턴 적용 필요 (DI, 인터페이스 등)
  - 성능/메모리 최적화 필요
  - 코드 복잡도 과다 (순환 복잡도 > 10)
  - 테스트 불가능한 구조
- 금지: 요구사항 불명확, 의존성 분석 미완료, 대체 대상 미확정

## 3) 단계별 마이그레이션 절차(완전한 대체)
1) **분석**: 기존 스크립트 의존성 분석, 사용처 식별, 데이터 마이그레이션 계획
2) **설계**: 새로운 스크립트 설계, 인터페이스 정의, 호환성 계획
3) **구현**: 새로운 스크립트 구현, 단위 테스트 작성, 성능 검증
4) **마이그레이션**: 사용처 점진적 변경, 데이터 마이그레이션, 호환성 검증
5) **정리**: 기존 스크립트 제거, 문서 업데이트, Git 히스토리 정리

## 3-α) Todo 기반 마이그레이션 관리(필수)
- 모든 마이그레이션은 Todo를 생성하고 상태로 추적: `pending → in_progress → completed/cancelled`
- 마이그레이션 단위: 완전한 기능 단위만 (부분 마이그레이션 금지)
- 규칙:
  - 새 단계 시작 전: 직전 Todo를 `completed`로 마감 후 다음 Todo를 `in_progress`로 설정
  - 병렬 마이그레이션 금지: 동시에 1개만 `in_progress` 유지
  - 완료 기준: 기존 스크립트 완전 제거, 모든 참조 정리, 테스트 통과

## 4) 스크립트 대체 규칙(코드 품질 기준)
- **네이밍**: 의미 기반 풀네임, 약어 금지, 일관된 접미사 규칙
- **구조**: SOLID 원칙 준수, 단일 책임, 의존성 역전
- **성능**: Update 최소화, 메모리 효율성, GC 압박 최소화
- **테스트**: 단위 테스트 가능, 모킹 가능, 의존성 주입 활용
- **문서**: XML 문서화, 한국어 주석, 사용 예시 포함

## 5) 완전한 대체 검증 기준
- **기능 동일성**: 모든 public API 동일한 동작 보장
- **성능 향상**: 메모리 사용량 감소 또는 실행 속도 향상
- **코드 품질**: 복잡도 감소, 가독성 향상, 유지보수성 증대
- **테스트 커버리지**: 기존 기능 100% 테스트 통과
- **문서 동기화**: 모든 관련 문서 업데이트 완료

## 6) 기존 스크립트 제거 규칙
- **단계적 제거**: 사용처 변경 → 참조 정리 → 스크립트 제거
- **Git 히스토리 보존**: `git mv` 또는 IDE 이동으로 이력 보존
- **의존성 정리**: 모든 using, 참조, 바인딩 정리
- **문서 정리**: 관련 문서에서 제거된 스크립트 참조 정리
- **검증**: 컴파일 에러 0, 런타임 에러 0, 테스트 통과

## 7) 코드 품질 향상 규칙
- **아키텍처 패턴**: DI, 인터페이스, 팩토리, 전략 패턴 적극 활용
- **성능 최적화**: 객체 풀링, 캐싱, 비동기 처리, 메모리 관리
- **에러 처리**: 예외 처리, 로깅, 복구 로직, 사용자 피드백
- **코드 스타일**: 일관된 네이밍, 적절한 주석, 리팩토링
- **테스트**: 단위 테스트, 통합 테스트, 성능 테스트

## 8) 마이그레이션 품질 게이트(완료 전 필수)
- 기존 스크립트 완전 제거 및 참조 정리 완료
- 새로운 스크립트 모든 테스트 통과
- 성능 향상 또는 동일한 성능 유지
- 문서 동기화 및 Delta 업데이트 완료
- Git 히스토리 정리 및 커밋 메시지 명확화

## 9) 마이그레이션 체크리스트(요약)
- [ ] 기존 스크립트 의존성 분석 완료
- [ ] 새로운 스크립트 설계 및 구현 완료
- [ ] 단위 테스트 작성 및 통과
- [ ] 사용처 점진적 마이그레이션 완료
- [ ] 기존 스크립트 완전 제거
- [ ] 모든 참조 및 의존성 정리
- [ ] 문서 동기화 및 Delta 업데이트
- [ ] 성능 검증 및 품질 확인

## 10) 변경 기록(Delta)
- 형식: `YYYY-MM-DD | 작성자 | 마이그레이션 요약 | 영향도(제거/추가/수정)`

예)
- 2025-01-27 | Maintainer | 스크립트 대체 및 마이그레이션 규칙 신규 제정 | 문서
- 2025-01-27 | Maintainer | 완전한 대체 및 품질 향상 규칙 추가 | 문서