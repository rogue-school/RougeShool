---
description: "SaveSystem ê°œë°œ ê°€ì´ë“œ ë° ê·œì¹™ - Unity 2D ì €ì¥ ì‹œìŠ¤í…œ í†µí•© ê´€ë¦¬"
globs: ["Assets/Script/SaveSystem/**/*.cs", "Assets/Script/CoreSystem/Save/**/*.cs"]
rule_id: save_system_rules
version: 1.2.0
alwaysApply: true
---

# SaveSystem ê°œë°œ ê·œì¹™

## ğŸ“‹ ì‹œìŠ¤í…œ ê°œìš”
SaveSystemì€ ê²Œì„ì˜ ì €ì¥/ë¡œë“œ ê¸°ëŠ¥ì„ ê´€ë¦¬í•˜ëŠ” ì‹œìŠ¤í…œì…ë‹ˆë‹¤. ìŠ¬ë ˆì´ ë” ìŠ¤íŒŒì´ì–´ ë°©ì‹ì˜ í„´ ê¸°ë°˜ ìë™ ì €ì¥ ì‹œìŠ¤í…œì„ ì œê³µí•˜ë©°, CoreSystemì— í†µí•©ë˜ì–´ ì „ì—­ì ìœ¼ë¡œ ê´€ë¦¬ë©ë‹ˆë‹¤. ICoreSystemInitializable ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ì—¬ ìë™ ì´ˆê¸°í™”ë˜ë©°, í•œêµ­ì–´ ë¡œê¹…ê³¼ ì”¬ ì „í™˜ ì§€ì†ì„±ì„ ì§€ì›í•©ë‹ˆë‹¤.

### ìµœê·¼ ë³€ê²½(ìš”ì•½)
- **CoreSystem í†µí•©**: ICoreSystemInitializable êµ¬í˜„ìœ¼ë¡œ ìë™ ì´ˆê¸°í™”
- **ì „ì—­ ì‹œìŠ¤í…œ**: CoreSceneì—ì„œ DontDestroyOnLoadë¡œ ì„¤ì •ë˜ì–´ ëª¨ë“  ì”¬ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥
- **í•œêµ­ì–´ ë¡œê¹…**: GameLoggerë¥¼ í†µí•œ ì¹´í…Œê³ ë¦¬ë³„ ë¡œê¹… (Save, Error)
- **ì”¬ ì „í™˜ ì§€ì†ì„±**: ì”¬ ì „í™˜ ì‹œì—ë„ ì €ì¥ ì‹œìŠ¤í…œ ìƒíƒœ ìœ ì§€
- **ìë™ ì €ì¥**: í„´ ì™„ë£Œ, ìŠ¤í…Œì´ì§€ ì™„ë£Œ ë“± íŠ¹ì • ì´ë²¤íŠ¸ ì‹œ ìë™ ì €ì¥
- **JSON ì§ë ¬í™”**: JsonUtilityë¥¼ í™œìš©í•œ ì•ˆì „í•œ ë°ì´í„° ì§ë ¬í™”

## ğŸ—ï¸ í´ë” êµ¬ì¡° ê·œì¹™
```
SaveSystem/
â”œâ”€â”€ Manager/           # ì €ì¥ ë§¤ë‹ˆì € (3ê°œ íŒŒì¼)
â”œâ”€â”€ Interface/         # ì €ì¥ ì¸í„°í˜ì´ìŠ¤ (2ê°œ íŒŒì¼)
â”œâ”€â”€ Data/              # ì €ì¥ ë°ì´í„° (3ê°œ íŒŒì¼)
â””â”€â”€ Event/             # ì €ì¥ ì´ë²¤íŠ¸ (2ê°œ íŒŒì¼)

CoreSystem/Save/       # ì‹¤ì œ êµ¬í˜„ ìœ„ì¹˜
â””â”€â”€ SaveManager.cs     # ì‹¤ì œ ì €ì¥ ë§¤ë‹ˆì € êµ¬í˜„ (í™•ì¥ë¨)
```

## ğŸ“ ì£¼ìš” ì»´í¬ë„ŒíŠ¸ ê·œì¹™

### Manager í´ë” ê·œì¹™ (3ê°œ íŒŒì¼)
- **CardStateCollector.cs**: ì¹´ë“œ ìƒíƒœ ìˆ˜ì§‘
- **CardStateRestorer.cs**: ì¹´ë“œ ìƒíƒœ ë³µì›
- **SaveManager.cs**: ì €ì¥ ë§¤ë‹ˆì €

### Interface í´ë” ê·œì¹™ (2ê°œ íŒŒì¼)
- **ISaveManager.cs**: ì €ì¥ ë§¤ë‹ˆì € ì¸í„°í˜ì´ìŠ¤
- **ICardStateManager.cs**: ì¹´ë“œ ìƒíƒœ ê´€ë¦¬ ì¸í„°í˜ì´ìŠ¤

### Data í´ë” ê·œì¹™ (3ê°œ íŒŒì¼)
- **CompleteCardStateData.cs**: ì™„ì „í•œ ì¹´ë“œ ìƒíƒœ ë°ì´í„°
- **PlayerHandData.cs**: í”Œë ˆì´ì–´ í•¸ë“œ ë°ì´í„°
- **EnemyHandData.cs**: ì  í•¸ë“œ ë°ì´í„°

### Event í´ë” ê·œì¹™ (2ê°œ íŒŒì¼)
- **SaveEventTrigger.cs**: ì €ì¥ ì´ë²¤íŠ¸ íŠ¸ë¦¬ê±°
- **AutoSaveTrigger.cs**: ìë™ ì €ì¥ íŠ¸ë¦¬ê±°

## ğŸ¯ ê°œë°œ ê·œì¹™

### 1. ìŠ¬ë ˆì´ ë” ìŠ¤íŒŒì´ì–´ ë°©ì‹ ê·œì¹™
- **í„´ ê¸°ë°˜ ìë™ ì €ì¥**: í„´ ì™„ë£Œ ì‹œ ìë™ ì €ì¥
- **ì™„ì „í•œ ìƒíƒœ ì €ì¥**: í”Œë ˆì´ì–´/ì  í•¸ë“œ, ì „íˆ¬ ìŠ¬ë¡¯, ì¹´ë“œ ìˆœí™˜ ìƒíƒœ ì €ì¥
- **ìƒíƒœ ë³µì›**: ì €ì¥ëœ ìƒíƒœì˜ ì™„ì „í•œ ë³µì›

### 2. ìë™ ì €ì¥ ì¡°ê±´ ê·œì¹™
- **AutoSaveTrigger**: íŠ¹ì • ê²Œì„ ì´ë²¤íŠ¸ ì‹œ ìë™ ì €ì¥
- **ì¡°ê±´ ê´€ë¦¬**: ìë™ ì €ì¥ ì¡°ê±´ ì¶”ê°€/ì œê±°/ì—…ë°ì´íŠ¸
- **ì´ë²¤íŠ¸ ê¸°ë°˜**: ê²Œì„ ì´ë²¤íŠ¸ì™€ ìë™ ì—°ë™

### 3. ë°ì´í„° êµ¬ì¡° ê·œì¹™
- **JSON ê¸°ë°˜**: JsonUtilityë¥¼ í™œìš©í•œ ë°ì´í„° ì§ë ¬í™”
- **íƒ€ì… ì•ˆì „ì„±**: ê°•íƒ€ì… ë°ì´í„° êµ¬ì¡°
- **ë°ì´í„° ê²€ì¦**: ì €ì¥ëœ ë°ì´í„°ì˜ ìœ íš¨ì„± ê²€ì¦

### 4. CoreSystem í†µí•© ê·œì¹™
- **ICoreSystemInitializable**: CoreSystem ì´ˆê¸°í™” ì¸í„°í˜ì´ìŠ¤ êµ¬í˜„ìœ¼ë¡œ ìë™ ì´ˆê¸°í™”
- **ì „ì—­ ì‹œìŠ¤í…œ**: CoreSceneì—ì„œ DontDestroyOnLoadë¡œ ì„¤ì •ë˜ì–´ ëª¨ë“  ì”¬ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥
- **ìë™ ì´ˆê¸°í™”**: CoreSystemInitializerì—ì„œ ìë™ìœ¼ë¡œ Initialize() í˜¸ì¶œ
- **ì”¬ ì „í™˜ ì§€ì†ì„±**: ì”¬ ì „í™˜ ì‹œì—ë„ ì €ì¥ ì‹œìŠ¤í…œ ìƒíƒœ ìœ ì§€
- **í•œêµ­ì–´ ë¡œê¹…**: GameLoggerë¥¼ í†µí•œ ì¹´í…Œê³ ë¦¬ë³„ ë¡œê¹… (Save, Error)
- **ì „ì—­ ì ‘ê·¼**: SaveManager.Instanceë¥¼ í†µí•œ ì–´ë””ì„œë“  ì ‘ê·¼ ê°€ëŠ¥

## ğŸ”§ ì‚¬ìš© ë°©ë²•

### ê¸°ë³¸ ì‚¬ìš©ë²•
```csharp
// AutoSaveManagerë¥¼ í†µí•œ ìë™ ì €ì¥
AutoSaveManager autoSaveManager = FindObjectOfType<AutoSaveManager>();

// íŠ¹ì • ì¡°ê±´ìœ¼ë¡œ ìë™ ì €ì¥ íŠ¸ë¦¬ê±°
autoSaveManager.TriggerAutoSave("EnemyCardPlaced");
autoSaveManager.TriggerAutoSave("TurnCompleted");

// ìˆ˜ë™ ì €ì¥
await autoSaveManager.SaveGameState("ManualSave");

// ê²Œì„ ìƒíƒœ ë¡œë“œ
autoSaveManager.LoadGameState("ManualSave_20250127_143022.json");

// ìë™ ì €ì¥ ì¡°ê±´ ê´€ë¦¬
autoSaveManager.AddAutoSaveCondition("CustomCondition", AutoSaveTrigger.Manual, "ì»¤ìŠ¤í…€ ì¡°ê±´");
autoSaveManager.RemoveAutoSaveCondition("CustomCondition");
autoSaveManager.UpdateAutoSaveCondition("TurnCompleted", true);
```

### SaveEventTriggerë¥¼ í†µí•œ ì´ë²¤íŠ¸ ê¸°ë°˜ ì €ì¥
```csharp
// SaveEventTriggerë¥¼ í†µí•œ ìë™ ì €ì¥ íŠ¸ë¦¬ê±°
SaveEventTrigger saveEventTrigger = FindObjectOfType<SaveEventTrigger>();

// í„´ ê´€ë ¨ ì´ë²¤íŠ¸
saveEventTrigger.OnEnemyCardPlaced();        // ì  ì¹´ë“œ ë°°ì¹˜ í›„
saveEventTrigger.OnTurnStartButtonPressed(); // í„´ ì‹œì‘ ë²„íŠ¼ ëˆ„ë¥´ê¸° ì „
saveEventTrigger.OnTurnExecution();          // í„´ ì‹¤í–‰ ì¤‘
saveEventTrigger.OnTurnCompleted();          // í„´ ì™„ë£Œ í›„

// ìŠ¤í…Œì´ì§€ ê´€ë ¨ ì´ë²¤íŠ¸
saveEventTrigger.OnStageCompleted();         // ìŠ¤í…Œì´ì§€ ì™„ë£Œ í›„
saveEventTrigger.OnStageFailed();            // ìŠ¤í…Œì´ì§€ ì‹¤íŒ¨ í›„

// ì „íˆ¬ ê´€ë ¨ ì´ë²¤íŠ¸
saveEventTrigger.OnCombatStart();            // ì „íˆ¬ ì‹œì‘ ì‹œ
saveEventTrigger.OnCombatEnd();              // ì „íˆ¬ ì¢…ë£Œ ì‹œ
```

### ë°ì´í„° êµ¬ì¡° ì‚¬ìš©ë²•
```csharp
// CompleteCardStateData ìƒì„± ë° ì‚¬ìš©
CompleteCardStateData cardState = new CompleteCardStateData();

// í”Œë ˆì´ì–´ í•¸ë“œì¹´ë“œ ì„¤ì •
cardState.playerHandSlots.Add(new CardSlotData("Card1", true));
cardState.playerHandSlots.Add(new CardSlotData("Card2", false));

// ì  í•¸ë“œì¹´ë“œ ì„¤ì •
cardState.enemyHandSlots.Add(new CardSlotData("EnemyCard1", true));
cardState.enemyHandSlots.Add(new CardSlotData("EnemyCard2", false));

// ì „íˆ¬ ìŠ¬ë¡¯ ì¹´ë“œ ì„¤ì •
cardState.firstSlotCard = new CardSlotData("CombatCard1", true);
cardState.secondSlotCard = new CardSlotData("CombatCard2", false);

// ì¹´ë“œ ìˆœí™˜ ìƒíƒœ ì„¤ì •
cardState.unusedStorageCards.Add("UnusedCard1");
cardState.unusedStorageCards.Add("UnusedCard2");
cardState.usedStorageCards.Add("UsedCard1");

// í„´ ìƒíƒœ ì„¤ì •
cardState.isPlayerFirst = true;

// ë°ì´í„° ìœ íš¨ì„± ê²€ì¦
if (cardState.IsValid())
{
    Debug.Log("ì¹´ë“œ ìƒíƒœ ë°ì´í„°ê°€ ìœ íš¨í•©ë‹ˆë‹¤.");
}
```

### AutoSaveCondition ê´€ë¦¬
```csharp
// ìë™ ì €ì¥ ì¡°ê±´ ìƒì„±
AutoSaveCondition condition = new AutoSaveCondition(
    "TurnCompleted", 
    AutoSaveTrigger.TurnComplete, 
    "í„´ ì™„ë£Œ ì‹œ ìë™ ì €ì¥"
);

// ì¡°ê±´ ìœ íš¨ì„± í™•ì¸
if (condition.IsValid())
{
    Debug.Log($"ì¡°ê±´ '{condition.conditionName}'ì´ ìœ íš¨í•©ë‹ˆë‹¤.");
}

// ì¡°ê±´ ì •ë³´ ì¶œë ¥
Debug.Log(condition.ToString());
```

### CoreSystem ì´ˆê¸°í™” ì—°ë™
```csharp
// ICoreSystemInitializable êµ¬í˜„ìœ¼ë¡œ ìë™ ì´ˆê¸°í™”
// CoreSystemInitializerì—ì„œ ìë™ìœ¼ë¡œ Initialize() í˜¸ì¶œë¨

// ì´ˆê¸°í™” ìƒíƒœ í™•ì¸
if (SaveManager.Instance.IsInitialized)
{
    // ì €ì¥ ì‹œìŠ¤í…œ ì‚¬ìš© ê°€ëŠ¥
    await SaveManager.Instance.SaveCurrentScene();
}

// ì”¬ ì „í™˜ ì‹œ ì €ì¥ ì‹œìŠ¤í…œ ì§€ì†ì„± í™•ì¸
// CoreSceneì—ì„œ DontDestroyOnLoadë¡œ ì„¤ì •ë˜ì–´ ëª¨ë“  ì”¬ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥
SaveManager.Instance.SaveAudioSettings(0.6f, 1.0f); // ì”¬ ì „í™˜ í›„ì—ë„ ì„¤ì • ìœ ì§€
var (bgm, sfx) = SaveManager.Instance.LoadAudioSettings(0.7f, 1.0f); // ì”¬ ì „í™˜ í›„ì—ë„ ì„¤ì • ë¡œë“œ

// í•œêµ­ì–´ ë¡œê¹…ê³¼ ì—°ë™
GameLogger.LogInfo("ì €ì¥ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ", GameLogger.LogCategory.Save);
GameLogger.LogWarning("ì €ì¥ íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨", GameLogger.LogCategory.Save);
GameLogger.LogError("ì €ì¥ ì‹œìŠ¤í…œ ì˜¤ë¥˜ ë°œìƒ", GameLogger.LogCategory.Error);
```

## ğŸ—ï¸ ì•„í‚¤í…ì²˜ íŒ¨í„´

### 1. ë§¤ë‹ˆì € íŒ¨í„´
- **AutoSaveManager**: ìë™ ì €ì¥ í†µí•© ê´€ë¦¬
- **SaveManager**: ì €ì¥ ì‹œìŠ¤í…œ í†µí•© ê´€ë¦¬

### 2. ì´ë²¤íŠ¸ íŒ¨í„´
- **SaveEventTrigger**: ì´ë²¤íŠ¸ ê¸°ë°˜ ì €ì¥ íŠ¸ë¦¬ê±°
- **AutoSaveTrigger**: ìë™ ì €ì¥ íŠ¸ë¦¬ê±°

### 3. ë°ì´í„° íŒ¨í„´
- **CompleteCardStateData**: ì™„ì „í•œ ì¹´ë“œ ìƒíƒœ ë°ì´í„°
- **ë°ì´í„° ê²€ì¦**: ì €ì¥ëœ ë°ì´í„°ì˜ ìœ íš¨ì„± ê²€ì¦

### 4. ì„œë¹„ìŠ¤ íŒ¨í„´
- **CardStateCollector**: ì¹´ë“œ ìƒíƒœ ìˆ˜ì§‘ ì„œë¹„ìŠ¤
- **CardStateRestorer**: ì¹´ë“œ ìƒíƒœ ë³µì› ì„œë¹„ìŠ¤

## ğŸ”§ ê¸°ìˆ ì  êµ¬í˜„ ì„¸ë¶€ì‚¬í•­

### ì„±ëŠ¥ ìµœì í™”
- **ë¹„ë™ê¸° ì €ì¥/ë¡œë“œ**: async/await íŒ¨í„´ìœ¼ë¡œ í”„ë ˆì„ ë¸”ë¡œí‚¹ ë°©ì§€
- **ë©”ëª¨ë¦¬ íš¨ìœ¨ì„±**: ì €ì¥ ë°ì´í„° ì§ë ¬í™” ì‹œ ë©”ëª¨ë¦¬ íš¨ìœ¨ì„±
- **ì••ì¶•**: ì €ì¥ ë°ì´í„° ì••ì¶•ì„ í†µí•œ ìš©ëŸ‰ ìµœì í™”

### ìŠ¤ë ˆë“œ ì•ˆì „ì„±
- **ë™ì‹œì„± ì œì–´**: ì €ì¥/ë¡œë“œ ì‹œ ë½ì„ í†µí•œ ë™ì‹œì„± ì œì–´
- **ë¹„ë™ê¸° ì²˜ë¦¬**: async/await íŒ¨í„´ì„ í†µí•œ ë¹„ë™ê¸° ì €ì¥/ë¡œë“œ
- **ì´ë²¤íŠ¸ ì²˜ë¦¬**: ìŠ¤ë ˆë“œ ì•ˆì „í•œ ì €ì¥ ì´ë²¤íŠ¸ ì‹œìŠ¤í…œ

### ë©”ëª¨ë¦¬ ê´€ë¦¬
- **ìƒëª…ì£¼ê¸° ê´€ë¦¬**: ì €ì¥ ë°ì´í„° ê°ì²´ì˜ ìƒì„±/ì†Œë©¸ ê´€ë¦¬
- **ë¦¬ì†ŒìŠ¤ í•´ì œ**: ì €ì¥ ì™„ë£Œ í›„ ë¦¬ì†ŒìŠ¤ ì •ë¦¬
- **ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ë°©ì§€**: ì´ë²¤íŠ¸ êµ¬ë… í•´ì œ, ë°ì´í„° ì°¸ì¡° í•´ì œ
