---
description: "AudioSystem 개발 가이드 및 규칙 - Unity 2D 오디오 시스템 통합 관리"
globs: ["Assets/Script/AudioSystem/**/*.cs", "Assets/Script/CoreSystem/Audio/**/*.cs"]
rule_id: audio_system_rules
version: 1.2.0
alwaysApply: true
---

# AudioSystem 개발 규칙

## 📋 시스템 개요
AudioSystem은 게임의 모든 오디오를 관리하는 시스템입니다. 오디오 풀링과 이벤트 기반 시스템을 제공하며, CoreSystem에 통합되어 전역적으로 관리됩니다. Zenject DI와 자동 초기화 시스템을 통해 안정적이고 확장 가능한 오디오 아키텍처를 제공합니다.

### 최근 변경(요약)
- **CoreSystem 통합 완료**: AudioManager가 CoreSystem의 일부로 통합 관리 완료
- **Zenject DI 통합 완료**: 의존성 주입을 통한 느슨한 결합 구현 완료
- **자동 초기화 완료**: ICoreSystemInitializable 인터페이스 기반 자동 초기화 완료
- **싱글톤 제거 완료**: AudioManager에서 싱글톤 패턴 제거하고 DI 패턴으로 전환 완료
- **인터페이스 기반 설계**: IAudioManager 인터페이스 구현으로 테스트 가능성 확보 완료
- **오디오 풀링 최적화**: AudioPoolManager를 통한 성능 최적화
- **우선순위 시스템**: 사운드별 우선순위 관리로 중요한 사운드 우선 재생

## 🏗️ 폴더 구조 규칙
```
AudioSystem/
└── (빈 폴더)          # 실제 구현은 CoreSystem/Audio에 위치

CoreSystem/Audio/     # 실제 구현 위치
├── AudioManager.cs           # 오디오 매니저 (싱글톤)
├── AudioPoolManager.cs       # 오디오 풀링 매니저
└── AudioEventTrigger.cs      # 오디오 이벤트 트리거
```

## 📁 주요 컴포넌트 규칙

### AudioManager.cs 규칙
- **싱글톤 패턴**: Instance 프로퍼티를 통한 전역 접근
- **ICoreSystemInitializable**: CoreSystem 초기화 인터페이스 구현
- **오디오 소스 관리**: BGM용, SFX용 AudioSource 분리 관리
- **페이드 효과**: BGM 전환 시 부드러운 페이드 인/아웃
- **오디오 풀링**: AudioPoolManager를 통한 사운드 중복 방지
- **볼륨 제어**: BGM, SFX 볼륨 개별 제어

### AudioPoolManager.cs 규칙
- **AudioSource 풀링**: 미리 생성된 AudioSource 풀 관리
- **사운드 중복 방지**: 쿨다운 시스템으로 동일 사운드 중복 재생 방지
- **우선순위 시스템**: 사운드별 우선순위 설정으로 중요한 사운드 우선 재생
- **자동 풀 반환**: 재생 완료 후 AudioSource 자동 풀 반환

### AudioEventTrigger.cs 규칙
- **이벤트 기반**: 게임 이벤트와 자동 연동
- **전용 사운드**: 카드 사용, 적 처치 등 전용 사운드 메서드

## 🎯 개발 규칙

### 1. 오디오 매니저 규칙
- **싱글톤 패턴**: Instance 프로퍼티를 통한 전역 접근
- **오디오 소스 관리**: 여러 AudioSource를 통한 동시 재생 지원
- **볼륨 제어**: 마스터, BGM, SFX 볼륨 개별 제어
- **페이드 효과**: BGM 페이드 인/아웃 지원

### 2. 오디오 풀링 규칙
- **AudioPoolManager**: 사운드 중복 방지
- **메모리 최적화**: 오디오 소스 재사용
- **성능 향상**: 오디오 소스 생성 비용 절약

### 3. 이벤트 기반 규칙
- **AudioEventTrigger**: 게임 이벤트 연동
- **자동 사운드**: 이벤트 발생 시 자동 사운드 재생
- **커스터마이징**: 이벤트별 사운드 커스터마이징

### 4. 사운드 우선순위 규칙
- **전투 사운드**: 우선순위 6-10 (높음)
- **UI 사운드**: 우선순위 3-5 (중간)
- **기타 사운드**: 우선순위 1-2 (낮음)

### 5. CoreSystem 통합 규칙
- **ICoreSystemInitializable**: CoreSystem 초기화 인터페이스 구현
- **자동 초기화**: CoreSystemInitializer에서 자동 초기화
- **전역 접근**: 싱글톤 패턴으로 어디서든 접근 가능
- **씬 전환 지속**: DontDestroyOnLoad로 씬 전환 시에도 유지
- **한국어 로깅**: GameLogger를 통한 카테고리별 로깅

### 6. Zenject DI 규칙
- **의존성 주입**: Zenject를 통한 느슨한 결합 구현
- **인터페이스 기반**: DI 바인딩은 인터페이스 기반으로 테스트 가능성 확보
- **생명주기 관리**: 적절한 스코프 설정으로 메모리 효율성 확보

## 🔧 사용 방법

### 기본 사용법
```csharp
// BGM 재생 (AudioClip 직접 전달)
AudioClip mainTheme = Resources.Load<AudioClip>("Sounds/BGM/MainTheme");
AudioManager.Instance.PlayBGM(mainTheme, true); // 페이드 인 옵션

// 효과음 재생 (기본 방식)
AudioClip buttonClick = Resources.Load<AudioClip>("Sounds/SFX/ButtonClick");
AudioManager.Instance.PlaySFX(buttonClick);

// 효과음 재생 (풀링 사용, 중복 방지)
AudioClip cardUse = Resources.Load<AudioClip>("Sounds/SFX/CardUse");
AudioManager.Instance.PlaySFXWithPool(cardUse, 1.0f, 8); // 볼륨, 우선순위

// 볼륨 설정
AudioManager.Instance.SetBGMVolume(0.6f);
AudioManager.Instance.SetSFXVolume(1.0f);

// BGM 정지
AudioManager.Instance.StopBGM();
```

### AudioPoolManager 직접 사용법
```csharp
// AudioPoolManager를 통한 고급 사운드 제어
AudioPoolManager poolManager = AudioManager.Instance.GetComponent<AudioPoolManager>();

// 우선순위 지정 사운드 재생
AudioClip enemyDefeat = Resources.Load<AudioClip>("Sounds/SFX/EnemyDefeat");
poolManager.PlaySound(enemyDefeat, 1.0f, 10); // 높은 우선순위

// 자동 우선순위 사운드 재생
AudioClip skillActivation = Resources.Load<AudioClip>("Sounds/SFX/SkillActivation");
poolManager.PlaySound(skillActivation, 0.8f); // 우선순위 자동 설정

// 쿨다운 상태 확인
if (!poolManager.IsInCooldown("ButtonClick"))
{
    poolManager.PlaySound(buttonClickClip, 0.7f);
}
```

### 사운드 우선순위 활용
```csharp
// 전투 사운드 (높은 우선순위) - 다른 사운드보다 우선 재생
poolManager.PlaySound(enemyDefeatClip, 1.0f, 10);
poolManager.PlaySound(skillActivationClip, 1.0f, 9);

// UI 사운드 (중간 우선순위)
poolManager.PlaySound(buttonClickClip, 0.7f, 5);
poolManager.PlaySound(cardDragClip, 0.5f, 4);

// 기타 사운드 (낮은 우선순위)
poolManager.PlaySound(ambientClip, 0.3f, 1);
```

### CoreSystem 초기화 연동
```csharp
// ICoreSystemInitializable 구현으로 자동 초기화
// CoreSystemInitializer에서 자동으로 Initialize() 호출됨

// 초기화 상태 확인
if (AudioManager.Instance.IsInitialized)
{
    // 오디오 시스템 사용 가능
    AudioManager.Instance.PlayBGM(bgmClip);
}

// 씬 전환 시 오디오 시스템 지속성 확인
// CoreScene에서 DontDestroyOnLoad로 설정되어 모든 씬에서 접근 가능
AudioManager.Instance.SetBGMVolume(0.6f); // 씬 전환 후에도 볼륨 유지
AudioManager.Instance.SetSFXVolume(1.0f); // 씬 전환 후에도 볼륨 유지

// 한국어 로깅과 연동
GameLogger.LogInfo("오디오 시스템 초기화 완료", GameLogger.LogCategory.Audio);
GameLogger.LogWarning("오디오 파일 로드 실패", GameLogger.LogCategory.Audio);
GameLogger.LogError("오디오 시스템 오류 발생", GameLogger.LogCategory.Error);
```

## 🏗️ 아키텍처 패턴

### 1. 싱글톤 패턴
- **AudioManager**: 전역 오디오 관리
- **Instance 접근**: 어디서든 접근 가능

### 2. 풀링 패턴
- **AudioPoolManager**: 오디오 소스 풀링
- **재사용**: 오디오 소스 재사용으로 성능 향상

### 3. 이벤트 패턴
- **AudioEventTrigger**: 이벤트 기반 사운드 재생
- **자동화**: 이벤트 발생 시 자동 사운드 재생

### 4. 전략 패턴
- **우선순위 시스템**: 사운드별 우선순위 전략
- **쿨다운 시스템**: 사운드 중복 방지 전략

## 🔧 기술적 구현 세부사항

### 성능 최적화
- **오디오 풀링**: 오디오 소스 재사용으로 성능 향상
- **메모리 관리**: 불필요한 오디오 소스 해제
- **압축**: 오디오 파일 압축으로 메모리 절약

### 스레드 안전성
- **싱글톤 안전성**: 스레드 안전한 싱글톤 구현
- **동시 재생**: 여러 사운드 동시 재생 지원

### 메모리 관리
- **리소스 해제**: 오디오 클립 사용 완료 후 해제
- **메모리 누수 방지**: 불필요한 참조 해제
